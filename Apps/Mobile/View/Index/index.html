<eq name="isAjax" value="1">
    <volist name="list" id="item">
        <li>
            <a href="{:U('Mobile/Index/storeDetail',array('shopid'=>$item['sid']))}">
                <img data-original="<empty name="item.logo">__PUBLIC__/statics/mobile/images/default_img.png<else/>__PUBLIC__/uploads/{$item.logo}_c200x200</empty>" src="__PUBLIC__/statics/mobile/images/default_img.png" alt="{$item.store_name}" />
                <div class="info-box">
                    <div class="line-item"><span class="name">{$item.store_name}</span></div>
                    <div class="line-item span-item"><span>{$item.products|msubstr=0,30}</span></div>
                    <div class="line-item span-item"><em data-lng="{$item.lng}" data-lat="{$item.lat}" class="distance address"></em>KM</div>
                </div>
            </a>
        </li>
    </volist>
<else/>
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />
    <title>3好连锁主页</title>
    <import type="css" file="statics.mobile.css.public,statics.mobile.css.style,dist.dropload" />
    <import type="js" file="scripts.zepto.zepto#min,scripts.zepto.zepto#fx,scripts.TouchSlide.TouchSlide#1#1,statics.mobile.js.region,statics.mobile.js.common,dist.dropload#min,scripts.zepto.lazyload#min" />
    <script type="text/javascript" src="__PUBLIC__/statics/ershou/js/rem.js" fu-psd="720" fu-min="50" fu-max="100"></script>
    <script type="text/javascript">
        var usersLng = {$Think.session.lng};//用户所在的经纬度
        var usersLat = {$Think.session.lat};
        if(isWeixin()) {
            usersLng = parseFloat(localStorage.getItem("longitude"));
            usersLat = parseFloat(localStorage.getItem("latitude"));
        }
    </script>
</head>
<body style="height: 100%;">
<!--头部-->
<div class="header">
    <div class="header-top">
        <div class="category-menu"><a href="{:U('Mobile/Goods/category')}">分类</a></div>
        <div class="a-wrap">
            <a href="javascript:;" class="home-logo"><img src="__PUBLIC__/statics/mobile/images/logo.png" alt="" class="logo"></a>
            <a href="javascript:;" class="area-tab"><span id="cityChange">深圳</span><i class="icon-allow-down"></i></a>
        </div>
        <div class="my-box"><a href="{:U('Mobile/Users/index')}">我的</a></div>
    </div>
    <div class="header-bottom">
        <div class="search-wrap">
            <i id="cancelBtn" class="icons icon-close fl"></i>
            <form class="search-form" id="searchForm" name="searchForm" method="get" action="{:U('Mobile/Search/list')}">
                <input type="text" class="search-input" name="keywords" id="keywords"  placeholder="请输入关键词" value="{$keywords}">
                <i class="icons icon-search-small"></i>
                <a href="javascript:void(0);" id="searchBtn" class="search-big-box"><i class="icons icon-search-big"></i></a>
            </form>
        </div>
    </div>
</div>
<div class="search-mask">
    <div class="prompt-box">
        <div class="current-search-box" id="searchOptionBox">
        </div>
        <notempty name="searchedKeywordsList">
            <div class="search-history">
                <h4>最近搜索：</h4>
                <div class="history-word hot-word">
                    <volist name="searchedKeywordsList" id="item">
                        <span><a href="{:U('Mobile/Search/list')}?keywords={$item.keyword}">{$item.keyword}</a></span>
                    </volist>
                </div>
            </div>
        </notempty>
        <div class="search-interest">
            <h4>热搜：</h4>
            <div class="hot-word">
                <volist name="hotKeywords" id="vo">
                    <span><a href="{:U('Mobile/Search/list')}?keywords={$item.keyword}">{$vo.keyword}</a></span>
                </volist>
            </div>
        </div>
    </div>
</div>
<div class="new-containter">
    <!--焦点图-->
    <div class="slider" id="slider">
        <div class="hd">
            <ul>
                <!--小圆点 当前的加class="on"-->
                <li class="on"></li>
                <li></li>
                <li></li>
            </ul>
        </div>
        <div class="bd">
            <ul>
                <li><img src="__PUBLIC__/statics/mobile/images/new_banner1.jpg" alt=""></li>
                <li><img src="__PUBLIC__/statics/mobile/images/new_banner2.jpg" alt=""></li>
                <li><img src="__PUBLIC__/statics/mobile/images/new_banner3.jpg" alt=""></li>
            </ul>
        </div>
        <!--焦点图-->
    </div>
    <!--头部-->
    <script>TouchSlide({slideCell:"#slider",mainCell:".bd ul",autoPlay:true});</script>
    <!--导航-->
    <div class="new-nav">
        <ul>
            <volist name="indexCategoryList" id="vo">
                <li><a href="{:U('Mobile/Goods/list',array('catid'=>$vo['id']))}"><img src="__PUBLIC__/uploads/{$vo[img_url]}" alt="{$vo[title]}" /><span>{$vo[title]}</span></a></li>
            </volist>
        </ul>
    </div>
    <!--导航-->
    <!--广告位-->
    <div class="adv-box">
        <a href="javascript:;"><img src="__PUBLIC__/statics/mobile/images/adv-bg-1.jpg" alt="广告图"/></a>
    </div>
    <!--广告位-->
    <!--独立部分-->
    <div class="part-independent">
        <div class="small-div part-div b-r b-b">
            <a href="http://www.zhengbenedu.com/mobile/index">
                <img src="__PUBLIC__/statics/mobile/images/part_1.jpg" alt="" />
            </a>
        </div>
        <div class="small-div part-div b-r b-b">
            <a href="http://www.caojinghua.cn/">
                <img src="__PUBLIC__/statics/mobile/images/part_2.jpg" alt="" />
            </a>
        </div>
        <div class="small-div part-div b-r b-b">
            <a href="http://www.xiaojukeji.com/index/index">
                <img src="__PUBLIC__/statics/mobile/images/part_3.jpg" alt="" />
            </a>
        </div>
        <div class="small-div part-div b-b">
            <a href="http://m.1688.com/market/-CBC4CCD8BEC6BCDBB8F1B1ED.html">
                <img src="__PUBLIC__/statics/mobile/images/part_4.jpg" alt="" />
            </a>
        </div>
        <div class="small-div part-div b-r">
            <a href="http://m.1688.com/winport/dgzuoqidz88.html">
                <img src="__PUBLIC__/statics/mobile/images/part_5.jpg" alt="" />
            </a>
        </div>
        <div class="small-div part-div b-r">
            <a href="https://h5.ele.me/msite/">
                <img src="__PUBLIC__/statics/mobile/images/part_6.jpg" alt="" />
            </a>
        </div>
        <div class="small-div part-div b-r">
            <a href="http://m.osrzh.com/">
                <img src="__PUBLIC__/statics/mobile/images/part_7.jpg" alt="" />
            </a>
        </div>
        <div class="small-div part-div">
            <a href="http://m.meilele.com">
                <img src="__PUBLIC__/statics/mobile/images/part_8.jpg" alt="" />
            </a>
        </div>
    </div>
    <!--独立部分-->
    <!--广告位-->
    <div class="adv-box">
        <a href="javascript:;"><img src="__PUBLIC__/statics/mobile/images/adv-bg-2.jpg" alt="广告图"/></a>
    </div>
    <!--广告位-->
    <!--好店推荐-->
    <div class="recommend">
        <div class="rec-title"><h2 class="fl">合作店铺</h2><a href="{:U('Mobile/Store/list')}" class="to-shop fr">更多店铺</a></div>
        <div class="goods-filter recommend-filter">
            <ul class="filter-ul">
                <li class="orderBtn sell all <eq name="order" value="1">selected</eq>" data-status="0" id="distance1"><span>综合</span></li>
                <li class="orderBtn sell type <eq name="order" value="2">selected</eq>" data-status="1" id="distance2"><span>距离</span></li>
                <li class="filter"><span>筛选</span></li>
            </ul>
<!--            <div class="nearby-box">
                <ul>
                    <li>1KM</li>
                    <li>2KM</li>
                    <li>3KM</li>
                </ul>
            </div>-->
        </div>
        <div class="rec-content-wrap" id="recContentWrap">
            <div class="rec-content">
                <ul>

                </ul>
            </div>
        </div>
    </div>
    <!--好店推荐-->

    <div class="over-lay"></div>
    <div class="over-lay-small"></div>
    <!--商品筛选-->
    <div class="kinds-box cooperation-kinds-box">
        <div class="kind-filter">
            <i class="icons icon-close-overlay fl"></i>
            <span class="fl">筛选</span>
        </div>
        <div class="filter-box">
            <div class="filter-item">
                <div class="item-tips">类别筛选：</div>
                <div class="item-tips">
                    <select id="typeId">
                        <option value="0">--请选择类别--</option>
                        <volist name="typeList" id="tl">
                            <option value="{$tl.id}"<eq name="tl.id" value="$type">selected</eq> >{$tl.type_name}</option>
                        </volist>
                    </select>
                </div>
            </div>
        </div>
        <div class="tools-btn-box">
            <a class="cancleBtn" href="javascirpt:;">取消</a>
            <a class="submit-btn" id="submitBtn" href="javascript:;">确定</a>
        </div>
    </div>
    <!--推荐-->
    <div style="height:75px;"></div>

</div>
<!--公用底部-->
<include file="Public/footer" />
<!--公用底部-->
<!--隐藏搜索部分 主页和产品列表页可以公用-->
<script type="text/javascript">
    /*搜索提示*/
    var inputChange = {
        input:function(obj){
            var obj = document.getElementById(obj);
            var inputLock = false;
            function doing(obj){
                $("#searchOptionBox").html("");
                var keywords = $("#keywords").val();
                if(keywords!=""){
                    //组合搜索下拉
                    var searchOptionStr = "";
                    searchOptionStr += "<div class=\"search-item-option\">";
                    var typeStr = "";
                    var defaultText = "的商品";
                    searchOptionStr += "<span><a href=\"{:U('Mobile/Search/list')}?keywords="+keywords
                        + typeStr + "\">搜索<em>“"+keywords+"”</em>" + defaultText + "</a></span>";
                    searchOptionStr += "</div>";
                    $("#searchOptionBox").append(searchOptionStr);
                }
            }
            obj.addEventListener('compositionstart', function() {
                inputLock = true;
            });
            obj.addEventListener('compositionend', function(event) {
                inputLock = false;
                doing(event.target);
            })
            obj.addEventListener('input', function(event) {
                if (!inputLock) {
                    doing(event.target);
                    event.returnValue = false;
                }
            });
        }
    }
    $(function(){
        inputChange.input("keywords");
    })
</script>
<script type="text/javascript">
    $(function(){
        /*懒加载*/
        $(".rec-content li img").lazyload({effect : "fadeIn"});
        /*关闭搜索*/
        $("i.icon-close").on("click",function(){
            $(".icon-search-small").show();
            $(".header-top").show();
            $(".header .icon-close").hide();
            $(".search-mask").hide();
            $(".search-big-box").hide();
            $(".header").removeClass("on-focus");
            $("body").css("overflow","auto");
        })
        /*搜索提交*/
        $("#searchBtn").on("touchstart",function(){
            var keywords = $("#keywords").val();
            if(keywords!=""){
                $("#searchForm").submit();
            }
        })
        /*点击搜索框获取焦点*/
        $(".search-input").on("click",function(){
            $(window).scrollTop(0);
            $(".icon-search-small").hide();
            $(".header-top").hide();
            $(".header .icon-close").show();
            $(".search-mask").show();
            $(".search-big-box").show();
            $(".header").addClass("on-focus");
            $("body").css("overflow","hidden");
        })
        /*头部搜索框动画*/
        $(window).scroll(function(){
            var sTop = $(window).scrollTop();
            if(sTop >= 20){
                $(".a-wrap").hide();
                $(".header-bottom").addClass("scroll-style");
                $(".header").addClass("change-color");
            }else{
                $(".a-wrap").show();
                $(".header-bottom").removeClass("scroll-style");
                $(".header").removeClass("change-color");
            }
        })
        /*筛选滑出*/
        $(".goods-filter li.filter").on("click",function(){
            $(".over-lay").show();
            $(".kinds-box").show().animate({"left":"15%"},300,function(){
                $(".tools-btn-box").addClass("tools-btn-box-show");
                $('html').addClass('noscroll');
                $("body").css("overflow-y","hidden");
            });

        })
        /*筛选隐藏*/
        $(".over-lay").on("click",function(){
            $(".tools-btn-box").removeClass("tools-btn-box-show");
            $(".kinds-box").animate({"left":"100%"},300,function(){
                $(".kinds-box").hide();
                $(".over-lay").hide();
                $('html').removeClass('noscroll');
                $("body").css({"overflow-y":"auto"});
            });

        })
        /*筛选隐藏*/
        $(".kind-filter .icon-close-overlay").on("click",function(){
            $(".kinds-box").animate({"left":"100%"},300,function(){
                $(".kinds-box").hide();
                $(".over-lay").hide();
                $('html').removeClass('noscroll');
                $("body").css({"overflow-y":"auto"});
            });
        })
        /*类型筛选*/
        $(".goods-filter li.type").on("click",function(){
            if($(".nearby-box").hasClass("open")){
                $(".nearby-box").removeClass("open");
                $("body").css({"overflow-y":"auto"});
            }else{
                $(".nearby-box").addClass("open");
                $("body").css({"overflow-y":"hidden"});
            }
        })
        //筛选提交
        $("#submitBtn").on("touchstart",function(){
            var type = $("#typeId").val();
            if(type!=""){
                jumpUrl = "{:U('Mobile/Index/index')}?type="+type+"&order={$order}&area_id={$area}";
                window.location.href = jumpUrl;
            }
        })
        //距离排序
        $("#distance1").on("touchstart",function(){
            window.location.href = "{:U('Mobile/Index/index')}?type={$type}&order=1&area_id={$area}";
        })
        $("#distance2").on("touchstart",function(){
            window.location.href = "{:U('Mobile/Index/index')}?type={$type}&order=2&area_id={$area}";
        })

        /*筛选取消*/
        $(".cancleBtn").on("touchstart",function(){
            $(".kinds-box").animate({"left":"100%"},300,function(){
                $(".kinds-box").hide();
                $(".over-lay").hide();
                $("body").css({"overflow":"auto"});
            });
        })
    });
    //滚动页面ajax自动获取下一页内容
    var page=1; //有效求购的页码
    var totalPage = {$totalPage}; //有效求购页的总页码，会从后台获
    var ajaxUrl="{:U('Mobile/Index/storeList')}";//ajax请求地址
    $(function(){
        var tabLoadEnd = false;
        var dropload = $('.rec-content-wrap').dropload({
            scrollArea : window,
            loadDownFn : function(me){
                // 加载菜单一的数据
                if(page <= totalPage){
                    $.ajax({
                        url:ajaxUrl,
                        type:"post",
                        dataType:"html",
                        data:{
                            'p':page,
                            'type':{$type},
                            'area_id':{$area},
                        },
                        success:function(data){
                            $('.rec-content-wrap ul').append(data);
                            //绑定计算距离
                            calcDistance(".distance");
                            //图片延迟加载
                            $(".rec-content li img").lazyload({effect : "fadeIn"});
                            // 每次数据加载完，必须重置
                            me.resetload();
                        },
                        error: function(xhr, type){
                            alert('Ajax error!');
                            // 即使加载出错，也得重置
                            me.resetload();
                        }
                    });
                    page++;
                }else{
                    // 数据加载完
                    tabLoadEnd = true;
                    // 锁定
                    me.lock();
                    // 无数据
                    me.noData();
                    me.resetload();
                }
                // 加载菜单二的数据
            }
        });
        // 如果数据没有加载完
        if(!tabLoadEnd){
            // 解锁
            dropload.unlock();
            dropload.noData(false);
        }else{
            // 锁定
            dropload.lock('down');
            dropload.noData();
        }
        // 重置
        dropload.resetload();
    });
</script>
</body>
</html>
</eq>